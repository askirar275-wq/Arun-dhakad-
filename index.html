<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Sky Shot â€” Fix (Auto-start & Visible Enemies)</title>
<style>
  :root{--accent:#3ec7ff;--accent2:#7b61ff}
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:#031229;color:#fff;font-family:Inter,Arial;overflow:hidden;-webkit-tap-highlight-color:transparent}
  #gameArea{position:relative;width:100vw;height:100vh;overflow:hidden}

  /* background layers - ensure stars behind */
  .stars{position:absolute;inset:0;background:
    radial-gradient(2px 2px at 10% 20%, rgba(255,255,255,0.9), transparent 8%),
    radial-gradient(1.5px 1.5px at 40% 70%, rgba(255,255,255,0.8), transparent 8%),
    radial-gradient(1px 1px at 80% 40%, rgba(255,255,255,0.6), transparent 8%);
    animation:tw 6s linear infinite;opacity:.95;z-index:0}
  @keyframes tw{0%{opacity:.7}50%{opacity:1}100%{opacity:.7}}

  /* clouds should be gentle and behind gameplay (low z) */
  .clouds{position:absolute;inset:0;pointer-events:none;z-index:2;opacity:0.6}
  .cloud{position:absolute;border-radius:80px;background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));box-shadow:0 10px 30px rgba(0,0,0,0.25);mix-blend-mode:screen}

  /* HUD must be above gameplay */
  #hud{position:absolute;left:12px;top:12px;z-index:60;display:flex;gap:12px;align-items:center}
  .panel{background:rgba(255,255,255,0.04);padding:8px 12px;border-radius:12px;border:1px solid rgba(255,255,255,0.06);font-weight:700;backdrop-filter:blur(4px)}

  /* player high z */
  #player{position:absolute;left:50%;bottom:18px;transform:translateX(-50%);width:66px;height:66px;border-radius:14px;background:linear-gradient(135deg,var(--accent),var(--accent2));box-shadow:0 8px 30px rgba(62,199,255,0.14);z-index:70;border:2px solid rgba(255,255,255,0.08);display:flex;align-items:center;justify-content:center}
  #player svg{width:50px;height:50px}

  /* bullets & enemies */
  .bullet{position:absolute;width:10px;height:26px;border-radius:6px;background:linear-gradient(180deg,#fff,#bfeaff);box-shadow:0 6px 18px rgba(62,199,255,0.22);z-index:75}
  .powerBullet{position:absolute;width:16px;height:40px;border-radius:8px;background:linear-gradient(180deg,#ffd36b,#ff7b6b);box-shadow:0 12px 36px rgba(255,120,80,0.24);z-index:76}

  .enemy{position:absolute;width:50px;height:50px;border-radius:12px;background:linear-gradient(180deg,#ff6666,#cc0033);box-shadow:0 8px 22px rgba(204,0,51,0.16);z-index:68;border:1px solid rgba(0,0,0,0.12)}
  .boss{position:absolute;width:160px;height:120px;border-radius:16px;background:linear-gradient(180deg,#ffb86b,#ff6b6b);box-shadow:0 20px 60px rgba(255,100,60,0.16);z-index:68;border:2px solid rgba(255,255,255,0.04)}
  .hpBar{position:absolute;left:50%;transform:translateX(-50%);bottom:-12px;height:8px;border-radius:8px;background:rgba(255,255,255,0.12);width:84%;overflow:hidden;border:1px solid rgba(0,0,0,0.12)}
  .hpFill{height:100%;background:linear-gradient(90deg,#2effa7,#00d2ff);width:100%}

  /* controls */
  #controls{position:absolute;left:50%;transform:translateX(-50%);bottom:10px;z-index:60;display:flex;gap:12px;align-items:center}
  .btn{background:transparent;border-radius:14px;padding:10px 14px;border:2px solid rgba(255,255,255,0.12);font-weight:800;font-size:15px;color:#fff;cursor:pointer;backdrop-filter:blur(6px);transition:transform .12s,box-shadow .12s;display:inline-flex;gap:8px;align-items:center}
  .btn:active{transform:scale(.96)}
  .btn.pulse{animation:pb 1.4s infinite}
  @keyframes pb{0%{box-shadow:0 8px 18px rgba(62,199,255,0.08)}50%{box-shadow:0 14px 30px rgba(62,199,255,0.16)}100%{box-shadow:0 8px 18px rgba(62,199,255,0.08)}}

  /* overlay kept above UI but hidden on auto-start */
  #overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:12px;background:linear-gradient(180deg, rgba(2,6,23,0.5), rgba(1,3,10,0.6));z-index:90}
  .bigBtn{padding:12px 28px;border-radius:16px;border:0;font-weight:900;background:linear-gradient(90deg,var(--accent),var(--accent2));color:#001;font-size:18px}

  .hitFlash{position:absolute;inset:0;pointer-events:none;opacity:0;transition:opacity .08s;background:rgba(255,255,255,0.04);z-index:85}

  @media (max-width:420px){
    #player{width:56px;height:56px}
    .boss{width:140px;height:100px}
    .btn{padding:9px 12px;font-size:14px}
  }
</style>
</head>
<body>
<div id="gameArea" aria-hidden="false">
  <div class="stars"></div>
  <div class="clouds" id="cloudLayer"></div>

  <div id="hud">
    <div class="panel" id="scorePanel">Score: <span id="score">0</span></div>
    <div class="panel" id="livesPanel"><span id="lives"></span></div>
    <div class="panel" style="display:flex;flex-direction:column;align-items:flex-start">
      <div style="font-size:12px;opacity:.9">Power</div>
      <div style="width:110px;height:14px;border-radius:12px;background:rgba(255,255,255,0.04);overflow:hidden;border:1px solid rgba(255,255,255,0.06)">
        <div id="powerFill" style="width:0%;height:100%;background:linear-gradient(90deg,#ffd36b,#ff7b6b)"></div>
      </div>
    </div>
  </div>

  <div id="player" aria-hidden="true">
    <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
      <path d="M32 6 L44 28 L32 22 L20 28 Z" fill="#fff" opacity=".16"/>
      <path d="M32 8 L46 30 L32 22 L18 30 Z" fill="#fff" opacity=".35"/>
      <circle cx="32" cy="38" r="10" fill="#00141a" opacity=".12"/>
    </svg>
  </div>

  <div class="hitFlash" id="hitFlash"></div>

  <div id="controls">
    <button class="btn" id="btnPause">PAUSE</button>
    <button class="btn pulse" id="btnPower">POWER</button>
    <button class="btn" id="btnBoost">BOOST</button>
  </div>

  <div id="overlay">
    <h1 style="margin:0">Sky Shot</h1>
    <p style="margin:0;opacity:.9">Tap anywhere to start (auto-start enabled).</p>
    <button class="bigBtn" id="startBtn">Start</button>
  </div>
</div>

<script>
/* Simplified + robust start & visible spawn behavior */

/* elements */
const gameArea = document.getElementById('gameArea');
const player = document.getElementById('player');
const scoreEl = document.getElementById('score');
const livesEl = document.getElementById('lives');
const powerFill = document.getElementById('powerFill');
const hitFlash = document.getElementById('hitFlash');
const cloudLayer = document.getElementById('cloudLayer');
const overlay = document.getElementById('overlay');
const startBtn = document.getElementById('startBtn');
const btnPause = document.getElementById('btnPause');
const btnPower = document.getElementById('btnPower');
const btnBoost = document.getElementById('btnBoost');

let state = {
  running:false, score:0, lives:3, power:0, powerMax:100,
  enemies:[], bullets:[], particles:[], boss:null,
  lastSpawn:0, spawnInterval:650, maxEnemies:5, bossActive:false
};

/* place player center */
function placePlayerCenter(){
  const rect = gameArea.getBoundingClientRect();
  player.style.left = Math.max(8, rect.width/2 - player.offsetWidth/2) + 'px';
}
window.addEventListener('resize', placePlayerCenter);
setTimeout(placePlayerCenter,50);

/* clouds (light and low z so they don't hide enemies) */
function spawnClouds(){
  // remove old
  document.querySelectorAll('.cloud').forEach(n=>n.remove());
  for(let i=0;i<3;i++){
    const c = document.createElement('div'); c.className='cloud';
    const w = 140 + Math.random()*260; c.style.width = w+'px'; c.style.height = (w*0.34)+'px';
    c.style.top = (6 + Math.random()*35) + '%'; c.style.left = (Math.random()*120 - 30) + '%';
    c.style.opacity = 0.18 + Math.random()*0.5;
    cloudLayer.appendChild(c);
    animateCloud(c, 18 + Math.random()*24);
  }
}
function animateCloud(el, dur){
  let left = parseFloat(el.style.left);
  if(isNaN(left)) left = -30;
  function f(){
    left += (100/dur)/60;
    if(left > 120) left = -40;
    el.style.left = left + '%';
    if(state.running) requestAnimationFrame(f);
    else setTimeout(()=> requestAnimationFrame(f), 1000);
  }
  requestAnimationFrame(f);
}

/* input */
function setPlayerXFromClient(clientX){
  const rect = gameArea.getBoundingClientRect();
  player.style.left = Math.max(8, Math.min(rect.width - player.offsetWidth - 8, clientX - rect.left - player.offsetWidth/2)) + 'px';
}
gameArea.addEventListener('touchstart', e=>{ if(e.touches[0]) setPlayerXFromClient(e.touches[0].clientX); }, {passive:true});
gameArea.addEventListener('touchmove', e=>{ if(e.touches[0]) setPlayerXFromClient(e.touches[0].clientX); }, {passive:true});
gameArea.addEventListener('mousemove', e=>{ setPlayerXFromClient(e.clientX); });

/* robust spawn: ensure visible top entries */
function spawnEnemy(){
  if(!state.running || state.bossActive) return;
  if(state.enemies.length >= state.maxEnemies) return;
  const e = document.createElement('div'); e.className='enemy';
  // pick x but avoid very edges so visible
  const w = gameArea.clientWidth;
  const margin = 20;
  const x = margin + Math.random() * (w - margin*2 - 50);
  e.style.left = x + 'px'; e.style.top = '-70px';
  e._vy = 1.6 + Math.random()*1.4; e._phase = Math.random()*Math.PI*2; e._wobble = 0.6 + Math.random()*1.2;
  gameArea.appendChild(e);
  state.enemies.push(e);
}

/* bullets */
function createBullet(power=false, sx=null, sy=null, vx=0, vy=-12){
  const el = document.createElement('div'); el.className = power ? 'powerBullet' : 'bullet';
  const left = (sx!==null)? sx : (player.offsetLeft + player.offsetWidth/2 - (power?8:5));
  const top = (sy!==null)? sy : (player.offsetTop - (power?42:26));
  el.style.left = left + 'px'; el.style.top = top + 'px'; gameArea.appendChild(el);
  state.bullets.push({el, vx, vy, power:!!power, fromBoss:false});
}

/* simple explosion */
function smallExplode(cx,cy,count=8){
  for(let i=0;i<count;i++){
    const p = document.createElement('div'); p.style.position='absolute';
    p.style.left = cx + 'px'; p.style.top = cy + 'px'; p.style.width = p.style.height = (3 + Math.random()*6) + 'px';
    p.style.borderRadius = '50%'; p.style.background = (Math.random()>0.5? '#ffd36b' : '#ff7b6b'); p.style.opacity='0.95'; p.style.zIndex=88;
    gameArea.appendChild(p);
    state.particles.push({el:p, vx:(Math.random()-0.5)*(2+Math.random()*3), vy:(Math.random()-0.5)*(2+Math.random()*3), life:28});
  }
}

/* collision check */
function rectsIntersect(a,b){
  return !(a.bottom < b.top || a.top > b.bottom || a.right < b.left || a.left > b.right);
}

/* rAF loop */
let lastFrame = performance.now();
let lastAutoFire = 0;
function gameLoop(ts){
  const dt = Math.min(40, ts - lastFrame);
  lastFrame = ts;
  if(state.running){
    // auto-fire
    if(ts - lastAutoFire > 180){ createBullet(false); lastAutoFire = ts; }

    // spawn control: ensure immediate spawns at start
    if(ts - state.lastSpawn > state.spawnInterval){
      state.lastSpawn = ts;
      if(state.enemies.length < state.maxEnemies && !state.bossActive) spawnEnemy();
    }

    // update bullets
    for(let i=state.bullets.length-1;i>=0;i--){
      const b = state.bullets[i];
      b.el.style.left = (b.el.offsetLeft + b.vx) + 'px';
      b.el.style.top = (b.el.offsetTop + b.vy) + 'px';
      // offscreen
      if(b.el.offsetTop < -80 || b.el.offsetTop > window.innerHeight + 120){ if(b.el.parentNode) b.el.remove(); state.bullets.splice(i,1); continue; }
      if(b.fromBoss && rectsIntersect(b.el.getBoundingClientRect(), player.getBoundingClientRect())){ if(b.el.parentNode) b.el.remove(); state.bullets.splice(i,1); hitPlayer(1); continue; }
    }

    // update enemies
    for(let i=state.enemies.length-1;i>=0;i--){
      const e = state.enemies[i];
      e._phase += 0.04;
      e.style.top = (e.offsetTop + e._vy) + 'px';
      e.style.left = (parseFloat(e.style.left) + Math.sin(e._phase) * e._wobble) + 'px';
      if(e.offsetTop > window.innerHeight - 110){ if(e.parentNode) e.remove(); state.enemies.splice(i,1); hitPlayer(1); continue; }

      // collision with bullets
      for(let j=state.bullets.length-1;j>=0;j--){
        const b = state.bullets[j];
        if(!b.el.parentNode) continue;
        if(rectsIntersect(b.el.getBoundingClientRect(), e.getBoundingClientRect())){
          if(e.parentNode) e.remove(); if(b.el.parentNode) b.el.remove();
          state.enemies.splice(i,1); state.bullets.splice(j,1);
          state.score += (b.power?3:1);
          smallExplode(e.offsetLeft + 24, e.offsetTop + 24, 6);
          break;
        }
      }
    }

    // particles
    for(let i=state.particles.length-1;i>=0;i--){
      const p = state.particles[i];
      p.el.style.left = (p.el.offsetLeft + p.vx) + 'px';
      p.el.style.top = (p.el.offsetTop + p.vy) + 'px';
      p.life--;
      p.el.style.opacity = Math.max(0, p.life/28);
      if(p.life <= 0){ if(p.el.parentNode) p.el.remove(); state.particles.splice(i,1); }
    }

    // UI update
    scoreEl.textContent = state.score;
    livesEl.innerHTML = Array.from({length:state.lives}).map(()=>'<span style="display:inline-block;width:12px;height:12px;border-radius:50%;background:#ff6b6b;margin-right:6px"></span>').join('');
    powerFill.style.width = state.power + '%';
  }
  requestAnimationFrame(gameLoop);
}

/* hit player */
function hitPlayer(dmg){ hitFlash.style.opacity='1'; setTimeout(()=> hitFlash.style.opacity='0',80); state.lives -= dmg; if(state.lives <= 0) endGame(); }

/* start / end */
function startGameAuto(){
  // hide overlay, reset state, start loops
  overlay.style.display = 'none';
  state.running = true; state.score = 0; state.lives = 3; state.power = 0; state.enemies=[]; state.bullets=[]; state.particles=[];
  document.querySelectorAll('.enemy,.bullet,.powerBullet,.boss').forEach(n=>n.remove());
  spawnClouds();
  // immediate spawn burst for visible action
  for(let i=0;i<3;i++){ setTimeout(spawnEnemy, i*120); }
  state.lastSpawn = performance.now();
  requestAnimationFrame(gameLoop);
}
function endGame(){
  state.running = false; overlay.style.display = 'flex';
  overlay.querySelector('h1').textContent = 'Game Over'; overlay.querySelector('p').textContent = 'Score: ' + state.score;
  startBtn.textContent = 'Play Again';
}

/* overlay / gesture: start on first tap anywhere (mobile friendly) */
function onFirstGesture(){
  // remove this listener after first gesture
  document.removeEventListener('pointerdown', onFirstGesture);
  // start audio context if present (not required)
  startGameAuto();
}
document.addEventListener('pointerdown', onFirstGesture, {passive:true});

/* start button also works */
startBtn.addEventListener('click', startGameAuto);

/* pause */
btnPause.addEventListener('click', ()=>{
  state.running = !state.running;
  if(state.running){ overlay.style.display='none'; requestAnimationFrame(gameLoop); spawnClouds(); btnPause.textContent='PAUSE'; }
  else { overlay.style.display='flex'; overlay.querySelector('h1').textContent='Paused'; overlay.querySelector('p').textContent='Tap RESUME to continue'; btnPause.textContent='RESUME'; }
});

/* small safety dynamic spawn adjust (keeps pressure moderate) */
setInterval(()=>{ state.spawnInterval = (state.enemies.length >= state.maxEnemies) ? 1100 : (600 + Math.random()*600); }, 900);

/* init */
setTimeout(()=>{ placePlayerCenter(); requestAnimationFrame(gameLoop); }, 80);

</script>
</body>
</html>
