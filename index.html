<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Sky Shot — Enemies Added</title>
<style>
  :root{--bg:#031229;--accent:#3ec7ff;--accent2:#7b61ff;--danger:#ff6b6b}
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg);color:#fff;font-family:Inter,Arial,Helvetica,sans-serif;overflow:hidden}
  #gameArea{position:relative;width:100vw;height:100vh;overflow:hidden;touch-action:none}

  /* HUD */
  #hud{position:absolute;left:12px;top:12px;z-index:400;display:flex;gap:8px;align-items:center}
  .panel{background:rgba(255,255,255,0.04);padding:8px 12px;border-radius:12px;border:1px solid rgba(255,255,255,0.06);font-weight:700;font-size:14px}

  /* Player */
  #player{position:absolute;left:50%;bottom:18px;transform:translateX(-50%);width:66px;height:66px;border-radius:14px;background:linear-gradient(135deg,var(--accent),var(--accent2));z-index:220;display:flex;align-items:center;justify-content:center;box-shadow:0 10px 30px rgba(62,199,255,0.08)}

  /* Bullet (img) */
  .bullet{position:absolute;left:0;top:0;width:48px;height:48px;pointer-events:none;z-index:350;will-change:transform;transform-origin:center center}
  .bullet.missing{width:16px;height:16px;border-radius:50%;background:#fff}

  /* Enemy */
  .enemy{position:absolute;width:56px;height:56px;border-radius:12px;background:linear-gradient(180deg,#ff6b6b,#d93c50);box-shadow:0 12px 30px rgba(204,0,51,0.12);z-index:200;border:1px solid rgba(0,0,0,0.08)}
  .enemy.small{width:40px;height:40px;border-radius:10px}

  /* Overlay / buttons */
  #overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:12px;z-index:500;background:linear-gradient(180deg,rgba(0,0,0,0.35),rgba(0,0,0,0.6))}
  .bigBtn{padding:12px 26px;border-radius:14px;border:0;background:linear-gradient(90deg,var(--accent),var(--accent2));color:#001;font-weight:800}
  .info{font-size:13px;opacity:.85}
  @media (max-width:420px){ .bullet{width:40px;height:40px} .enemy{width:48px;height:48px} .panel{font-size:13px} }
</style>
</head>
<body>
<div id="gameArea" aria-label="Sky Shot Game">
  <div id="hud">
    <div class="panel">Score: <span id="score">0</span></div>
    <div class="panel">High: <span id="highscore">0</span></div>
    <div class="panel">Lives: <span id="lives">3</span></div>
  </div>

  <div id="player" aria-hidden="true">
    <svg viewBox="0 0 64 64" width="46" height="46" aria-hidden="true">
      <path d="M32 6 L44 28 L32 22 L20 28 Z" fill="#fff" opacity=".18"/>
      <circle cx="32" cy="38" r="10" fill="#00141a" opacity=".12"/>
    </svg>
  </div>

  <div id="overlay" role="dialog">
    <h2 style="margin:0">Sky Shot</h2>
    <p class="info" style="margin:0">Tap to start. Bullets rotate with direction. Enemies spawn from top — shoot them!</p>
    <button class="bigBtn" id="startBtn">Start</button>
    <div class="info" style="margin-top:6px">Keep <code>image/bullet.png</code> in an <code>image/</code> folder</div>
  </div>
</div>

<script>
/* =========================
   CONFIG
   ========================= */
const BULLET_IMG = 'image/bullet.png';
const AUTO_FIRE_INTERVAL = 300; // ms between auto bursts
const BURST_COUNT = 3;
const BURST_SPREAD = 12;
const MAX_BULLETS = 28;
const ENEMY_SPAWN_BASE = 900;   // base ms
const MAX_ENEMIES = 7;
const HIGH_KEY = 'skyshot_enemy_high_v1';

/* =========================
   DOM
   ========================= */
const gameArea = document.getElementById('gameArea');
const player = document.getElementById('player');
const overlay = document.getElementById('overlay');
const startBtn = document.getElementById('startBtn');
const scoreEl = document.getElementById('score');
const highEl = document.getElementById('highscore');
const livesEl = document.getElementById('lives');

/* =========================
   STATE
   ========================= */
let state = {
  running:false,
  bullets:[],   // {el,x,y,vx,vy,power,fromBoss}
  enemies:[],   // DOM elements with custom props
  score:0,
  high: parseInt(localStorage.getItem(HIGH_KEY) || '0',10) || 0,
  lives:3,
  lastFire:0,
  lastSpawn:0
};
highEl.textContent = state.high;
livesEl.textContent = state.lives;

/* =========================
   Utility: player origin using offsets (reliable)
   ========================= */
function getPlayerOrigin(){
  // use offsetLeft/offsetTop which is relative to offsetParent (gameArea) when player is direct child
  const centerX = player.offsetLeft + player.offsetWidth/2;
  const topY = player.offsetTop;
  return { x: Math.round(centerX), y: Math.round(topY) };
}

/* =========================
   Bullet rotation helper
   ========================= */
function angleDegFromVector(vx, vy){
  const rad = Math.atan2(vy, vx);
  const deg = rad * 180 / Math.PI;
  return deg + 90; // adjust so vy<0 gives angle ~0 (upwards)
}

/* =========================
   Spawn bullet (image) at gameArea coords
   ========================= */
function spawnSingleBulletAt(x, y, vx=0, vy=-14, power=false, fromBoss=false){
  // cap bullets
  if(state.bullets.length >= MAX_BULLETS){
    const old = state.bullets.shift();
    if(old && old.el && old.el.parentNode) old.el.remove();
  }
  const el = document.createElement('img');
  el.className = 'bullet';
  el.draggable = false;
  el.src = BULLET_IMG;
  el.onerror = ()=> el.classList.add('missing');

  const w = 48, h = 48;
  const sx = x - w/2;
  const sy = y - h - 6;

  const ang = angleDegFromVector(vx, vy);
  el.style.left = '0px';
  el.style.top = '0px';
  el.style.transform = `translate(${sx}px, ${sy}px) rotate(${ang}deg)`;

  gameArea.appendChild(el);
  state.bullets.push({el, x: sx, y: sy, vx, vy, power, fromBoss});
}

/* Burst fire centered on player */
function fireBurstFromPlayer(centerXOffset = 0){
  const origin = getPlayerOrigin();
  for(let i=0;i<BURST_COUNT;i++){
    const offset = (i - Math.floor(BURST_COUNT/2)) * BURST_SPREAD + (Math.random()-0.5)*4 + centerXOffset;
    const vx = offset * 0.03;
    const vy = -14 + (Math.random()-0.5)*1.6;
    spawnSingleBulletAt(origin.x + offset, origin.y + (Math.random()-0.5)*6, vx, vy, false, false);
  }
}

/* =========================
   Enemy spawn & behavior
   ========================= */
function spawnEnemy(){
  if(!state.running) return;
  if(state.enemies.length >= MAX_ENEMIES) return;
  const e = document.createElement('div');
  e.className = 'enemy';
  // random size small chance
  if(Math.random() < 0.14) e.classList.add('small');
  const margin = 18;
  const x = margin + Math.random() * (gameArea.clientWidth - margin*2 - 56);
  e.style.left = x + 'px';
  e.style.top = '-80px';
  // attach movement props
  e._vy = 1.6 + Math.random()*1.6;
  e._phase = Math.random()*Math.PI*2;
  e._wobble = 0.6 + Math.random()*1.6;
  gameArea.appendChild(e);
  state.enemies.push(e);
}

/* =========================
   Collision helpers
   ========================= */
function rectsIntersect(A,B){
  return !(A.bottom < B.top || A.top > B.bottom || A.right < B.left || A.left > B.right);
}

/* =========================
   Player hit / lives
   ========================= */
function hitPlayer(damage){
  // flash (simple)
  const flash = document.createElement('div');
  flash.style.position = 'absolute';
  flash.style.inset = '0';
  flash.style.background = 'rgba(255,255,255,0.04)';
  flash.style.zIndex = 600;
  gameArea.appendChild(flash);
  setTimeout(()=> flash.remove(), 90);

  state.lives -= damage;
  if(state.lives < 0) state.lives = 0;
  livesEl.textContent = state.lives;
  if(state.lives <= 0) endGame();
}

/* =========================
   Game loop: update bullets/enemies/collisions
   ========================= */
let lastFrame = performance.now();
function gameLoop(ts){
  const dt = Math.min(40, ts - lastFrame); lastFrame = ts;

  if(state.running){
    // Auto fire every interval
    if(ts - state.lastFire > AUTO_FIRE_INTERVAL){
      state.lastFire = ts; fireBurstFromPlayer();
    }

    // spawn enemies with base interval (faster as score grows slightly)
    const spawnInterval = Math.max(300, ENEMY_SPAWN_BASE - Math.floor(state.score * 8));
    if(ts - state.lastSpawn > spawnInterval){
      state.lastSpawn = ts; spawnEnemy();
    }

    // update bullets
    for(let i = state.bullets.length - 1; i >= 0; i--){
      const b = state.bullets[i];
      b.x += b.vx * (dt/16.67);
      b.y += b.vy * (dt/16.67);
      const ang = angleDegFromVector(b.vx, b.vy);
      b.el.style.transform = `translate(${b.x}px, ${b.y}px) rotate(${ang}deg)`;
      // remove offscreen
      if(b.y < -260 || b.x < -400 || b.x > window.innerWidth + 400){
        if(b.el.parentNode) b.el.remove();
        state.bullets.splice(i,1);
      }
    }

    // update enemies
    for(let i = state.enemies.length - 1; i >= 0; i--){
      const e = state.enemies[i];
      e._phase += 0.03;
      e.style.top = (e.offsetTop + e._vy) + 'px';
      e.style.left = (parseFloat(e.style.left) + Math.sin(e._phase) * e._wobble) + 'px';
      // if reach bottom
      if(e.offsetTop > window.innerHeight - 90){
        if(e.parentNode) e.remove();
        state.enemies.splice(i,1);
        hitPlayer(1);
        continue;
      }
    }

    // collisions: bullet vs enemy
    for(let ei = state.enemies.length - 1; ei >= 0; ei--){
      const e = state.enemies[ei];
      const er = e.getBoundingClientRect();
      for(let bi = state.bullets.length - 1; bi >= 0; bi--){
        const b = state.bullets[bi];
        if(!b.el.parentNode) continue;
        const br = b.el.getBoundingClientRect();
        if(rectsIntersect(br, er)){
          // destroy both
          if(e.parentNode) e.remove();
          if(b.el.parentNode) b.el.remove();
          state.enemies.splice(ei,1);
          state.bullets.splice(bi,1);
          // scoring: small enemy = 2, normal = 1
          const pts = e.classList.contains('small') ? 2 : 1;
          state.score += pts;
          scoreEl.textContent = state.score;
          // save high if needed
          if(state.score > state.high){ state.high = state.score; localStorage.setItem(HIGH_KEY, String(state.high)); highEl.textContent = state.high; }
          break;
        }
      }
    }

    // (Optional) enemies vs player collision — skip for now

  }

  lastFrame = ts;
  requestAnimationFrame(gameLoop);
}

/* =========================
   Start / end game
   ========================= */
function startGame(){
  overlay.style.display = 'none';
  // reset
  state.running = true;
  state.score = 0; state.lives = 3;
  scoreEl.textContent = 0; livesEl.textContent = state.lives;
  // cleanup DOM
  state.bullets.forEach(b=>{ if(b.el.parentNode) b.el.remove(); }); state.bullets = [];
  state.enemies.forEach(e=>{ if(e.parentNode) e.remove(); }); state.enemies = [];
  state.lastFire = performance.now() - 200;
  state.lastSpawn = performance.now();
  // immediate spawn so player sees action
  for(let i=0;i<4;i++) setTimeout(spawnEnemy, i*80);
  requestAnimationFrame(gameLoop);
}

function endGame(){
  state.running = false;
  overlay.style.display = 'flex';
  overlay.querySelector('h2').textContent = 'Game Over';
  overlay.querySelector('.info')?.remove?.(); // remove old hint if any
  const p = document.createElement('p'); p.className = 'info'; p.style.margin = '6px 0 0 0'; p.textContent = 'Score: ' + state.score + (state.score > state.high ? ' — New High!' : '');
  overlay.appendChild(p);
}

/* =========================
   Input: player movement & manual fire on tap
   ========================= */
function setPlayerXFromClient(clientX){
  const rect = gameArea.getBoundingClientRect();
  const px = clientX - rect.left - player.offsetWidth/2;
  const clamped = Math.max(6, Math.min(gameArea.clientWidth - player.offsetWidth - 6, px));
  player.style.left = clamped + 'px';
}
gameArea.addEventListener('touchstart', e=>{ if(e.touches[0]) setPlayerXFromClient(e.touches[0].clientX); }, {passive:true});
gameArea.addEventListener('touchmove', e=>{ if(e.touches[0]) setPlayerXFromClient(e.touches[0].clientX); }, {passive:true});
gameArea.addEventListener('mousemove', e=>{ if(e.buttons) setPlayerXFromClient(e.clientX); });

/* manual tap to fire too (useful) */
gameArea.addEventListener('pointerdown', (ev)=>{
  if(!state.running) return;
  // ignore clicking overlay/button
  if(ev.target.closest('button')) return;
  // fire burst
  fireBurstFromPlayer();
}, {passive:true});

/* start button */
startBtn.addEventListener('click', ()=> startGame());

/* first gesture to start */
document.addEventListener('pointerdown', function first(){ document.removeEventListener('pointerdown', first); startGame(); }, {passive:true});

/* =========================
   Done
   ========================= */
console.log('Sky Shot with enemies loaded. Keep bullet image at:', BULLET_IMG);
</script>
</body>
</html>
