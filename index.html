<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ChatApp ‚Äî 1:1 Private Chat</title>
<style>
:root{
  --bg:#0f1724;--card:#0b1220;--accent:#60a5fa;--accent-hover:#7c3aed;--muted:#94a3b8;--glass:rgba(255,255,255,0.04);
  --radius:12px;--padding:12px;--shadow-light:rgba(96,165,250,0.12);--shadow-dark:rgba(2,6,23,0.6);--font-main:'Inter',system-ui,Roboto,Arial;
}
*{box-sizing:border-box;font-family:var(--font-main)}
html,body{height:100%;margin:0;background:var(--bg);color:#e6eef8}
.wrap{max-width:880px;margin:28px auto;padding:18px}
header{display:flex;align-items:center;gap:12px}
.logo{width:56px;height:56px;background:linear-gradient(135deg,var(--accent),var(--accent-hover));border-radius:var(--radius);display:flex;align-items:center;justify-content:center;font-weight:700;box-shadow:0 6px 20px var(--shadow-dark)}
h1{font-size:20px;margin:0}
p.lead{margin:4px 0 18px;color:var(--muted)}
.card{background:linear-gradient(180deg,var(--card),#071122);padding:18px;border-radius:var(--radius);box-shadow:0 6px 30px var(--shadow-dark);border:1px solid rgba(255,255,255,0.03);margin-bottom:20px;transition:transform 0.2s ease}
.card:hover{transform: translateY(-2px);}
label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
input[type=text], select{width:100%;padding:var(--padding);border-radius:var(--radius);background:var(--glass);border:1px solid rgba(255,255,255,0.04);color:inherit;font-size:15px;transition:all 0.2s ease}
input[type=text]:focus, select:focus{border-color:var(--accent);box-shadow:0 0 8px var(--shadow-light);outline:none;}
.btn{display:inline-flex;align-items:center;gap:10px;padding:10px 14px;border-radius:var(--radius);border:2px solid var(--accent);background:transparent;color:var(--accent);cursor:pointer;font-weight:600;transition:all 0.2s ease}
.btn:hover{transform:translateY(-3px);box-shadow:0 8px 30px var(--shadow-light)}
.btn:active{transform:scale(0.97)}
.btn-primary{background:linear-gradient(90deg,var(--accent),var(--accent-hover));color:#021026;border:2px solid rgba(255,255,255,0.06);box-shadow:0 10px 30px rgba(124,58,237,0.12)}
.muted{color:var(--muted);font-size:13px}
.chat-area{height:50vh;border-radius:var(--radius);padding:var(--padding);overflow:auto;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.02);scroll-behavior:smooth}
.msg{max-width:70%;padding:8px 12px;border-radius:var(--radius);margin:8px 0;word-wrap:break-word;animation:fadeIn 0.25s ease;position:relative}
.msg.me{background:linear-gradient(90deg,#05203b,rgba(96,165,250,0.08));margin-left:auto;color:white}
.msg.other{background:rgba(255,255,255,0.06);color:#e6eef8}
.timestamp{font-size:10px;color:var(--muted);position:absolute;bottom:-14px;right:8px}
.typing{font-size:12px;color:var(--accent);margin-top:4px}
@keyframes fadeIn{from {opacity:0; transform:translateY(5px);} to {opacity:1; transform:translateY(0);}}
@media (max-width: 500px){.card button{width:100%;}.card div[style*='display:flex']{flex-direction:column;gap:8px;}}
</style>
</head>
<body>
<div class="wrap">
<header>
<div class="logo">C</div>
<div>
<h1>ChatApp ‚Äî 1:1 Private Chat</h1>
<p class="lead">Firebase Phone OTP + Private Messages</p>
</div>
</header>

<section class="card">
<h3>‡§≤‡•â‡§ó‡§ø‡§® OTP ‡§∏‡•á</h3>
<label for="phone">‡§´‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞ (+91 9xxxxxxxxx)</label>
<input id="phone" type="text" placeholder="+91..." />
<div id="recaptcha-container" style="margin-top:12px" class="muted">reCAPTCHA ‡§Ø‡§π‡§æ‡§Å ‡§¶‡§ø‡§ñ‡•á‡§ó‡§æ</div>
<div style="margin-top:12px;display:flex;gap:10px">
<button id="sendBtn" class="btn">Send OTP</button>
<button id="signOutBtn" class="btn">Sign Out</button>
</div>
<label for="otp" style="margin-top:12px">OTP ‡§°‡§æ‡§≤‡•á‡§Ç</label>
<input id="otp" type="text" placeholder="6-digit code" />
<button id="verifyBtn" class="btn btn-primary" style="margin-top:10px">Verify</button>
<div id="status" style="margin-top:12px" class="muted">‡§∏‡•ç‡§ü‡•á‡§ü‡§∏: ‡§á‡§Ç‡§§‡§ú‡§º‡§æ‡§∞...</div>
</section>

<section class="card">
<h3>‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ Private Chat</h3>
<label for="selectUser">‡§ï‡§ø‡§∏‡§∏‡•á ‡§ö‡•à‡§ü ‡§ï‡§∞‡§®‡§æ ‡§π‡•à?</label>
<select id="selectUser"><option value="">-- User Select ‡§ï‡§∞‡•á‡§Ç --</option></select>
<div id="chatArea" class="chat-area"></div>
<div id="typing" class="typing"></div>
<div style="display:flex;gap:8px;align-items:center;margin-top:10px">
<input id="message" type="text" placeholder="Message..." style="flex:1;padding:10px 12px;border-radius:var(--radius);background:var(--glass);border:1px solid rgba(255,255,255,0.03)" />
<button id="emojiBtn" class="btn">üòä</button>
<button id="sendMsg" class="btn btn-primary">Send</button>
</div>
</section>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>
// ‚úÖ Tumhara Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyAYiCfR1-UrHO4URnkkzVmqDEiHdWOvFZ8",
  authDomain: "chatapp-66809.firebaseapp.com",
  projectId: "chatapp-66809",
  storageBucket: "chatapp-66809.firebasestorage.app",
  messagingSenderId: "513053373469",
  appId: "1:513053373469:web:d99d27f12f0176c5e2c2f4",
  measurementId: "G-T32WEZW4LW"
};

// Firebase initialize
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

const phoneInput = document.getElementById('phone');
const otpInput = document.getElementById('otp');
const statusDiv = document.getElementById('status');
const chatArea = document.getElementById('chatArea');
const msgInput = document.getElementById('message');
const selectUser = document.getElementById('selectUser');
const typingDiv = document.getElementById('typing');
const emojiBtn = document.getElementById('emojiBtn');

let confirmationResult, unsubscribe=null;

// Status
function setStatus(t,err){ statusDiv.textContent='‡§∏‡•ç‡§ü‡•á‡§ü‡§∏: '+t; statusDiv.style.color=err?'#ffb4b4':'var(--muted)'; }

// Chat ID
function getChatId(uid1,uid2){ return [uid1,uid2].sort().join('_'); }

// Render message
function renderMessage(text, me, ts, docRef){
  const div = document.createElement('div');
  div.className='msg '+(me?'me':'other');
  div.textContent=text;

  const time = document.createElement('div');
  time.className='timestamp';
  time.textContent = ts ? new Date(ts.seconds*1000).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'}) : '';
  div.appendChild(time);

  if(me){
    const delBtn = document.createElement('span');
    delBtn.textContent=' üóë';
    delBtn.style.cursor='pointer';
    delBtn.onclick = async ()=>{if(confirm('Message delete kare?')) await docRef.delete();}
    div.appendChild(delBtn);
  }

  chatArea.appendChild(div);
  chatArea.scrollTop = chatArea.scrollHeight;
}

// reCAPTCHA
window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('sendBtn', { size:'invisible' });
window.recaptchaVerifier.render();

// Send OTP
document.getElementById('sendBtn').onclick = async ()=>{
  const num = phoneInput.value.trim();
  if(!num){ setStatus('‡§®‡§Ç‡§¨‡§∞ ‡§°‡§æ‡§≤‡•á‡§Ç', true); return; }
  try{
    confirmationResult = await auth.signInWithPhoneNumber(num, window.recaptchaVerifier);
    setStatus('OTP ‡§≠‡•á‡§ú‡§æ ‡§ó‡§Ø‡§æ, Verify ‡§ï‡§∞‡•á‡§Ç');
  }catch(e){ console.error(e); setStatus('Error: '+e.message,true); window.recaptchaVerifier.clear(); window.recaptchaVerifier.render();}
}

// Verify OTP
document.getElementById('verifyBtn').onclick = async ()=>{
  try{
    const code = otpInput.value.trim();
    const res = await confirmationResult.confirm(code);
    setStatus('Login success: '+res.user.phoneNumber);
    await db.collection('users').doc(res.user.uid).set({phone:res.user.phoneNumber},{merge:true});
    loadUsers();
  }catch(e){setStatus('OTP ‡§ó‡§≤‡§§: '+e.message,true);}
}

// Sign Out
document.getElementById('signOutBtn').onclick = ()=>{
  auth.signOut();
  chatArea.innerHTML='';
  selectUser.innerHTML='<option value="">-- User Select ‡§ï‡§∞‡•á‡§Ç --</option>';
  setStatus('Signed out');
}

// Load users
async function loadUsers(){
  const snap = await db.collection('users').get();
  selectUser.innerHTML='<option value="">-- User Select ‡§ï‡§∞‡•á‡§Ç --</option>';
  snap.forEach(doc=>{
    if(doc.id!==auth.currentUser.uid){
      const opt = document.createElement('option');
      opt.value=doc.id; opt.textContent=doc.data().phone;
      selectUser.appendChild(opt);
    }
  });
}

// Send Message
document.getElementById('sendMsg').onclick = async ()=>{
  const text = msgInput.value.trim();
  const otherUser = selectUser.value;
  if(!text || !otherUser){ setStatus('User select kare aur message dale',true); return;}
  const chatId = getChatId(auth.currentUser.uid,otherUser);
  await db.collection('chats').doc(chatId).collection('messages').add({text,uid:auth.currentUser.uid,ts:firebase.firestore.FieldValue.serverTimestamp(),read:false});
  msgInput.value='';
}

// Emoji
emojiBtn.onclick = ()=>{
  const emoji = prompt("Emoji ‡§°‡§æ‡§≤‡•á‡§Ç ‡§Ø‡§æ copy-paste ‡§ï‡§∞‡•á‡§Ç üôÇüòÇ‚ù§Ô∏è...");
  if(emoji) msgInput.value += emoji;
}

// Load chat on user select
selectUser.onchange = ()=>{
  chatArea.innerHTML='';
  if(unsubscribe) unsubscribe();
  const otherUser = selectUser.value;
  if(!otherUser) return;
  const chatId = getChatId(auth.currentUser.uid,otherUser);
  unsubscribe = db.collection('chats').doc(chatId).collection('messages').orderBy('ts').onSnapshot(snap=>{
    chatArea.innerHTML='';
    snap.forEach(doc=>{
      const m = doc.data();
      renderMessage(m.text,m.uid===auth.currentUser.uid,m.ts,doc.ref);
      if(!m.read && m.uid!==auth.currentUser.uid) doc.ref.update({read:true});
    });
  });
}
</script>
</body>
</html>
